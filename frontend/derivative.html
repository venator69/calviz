<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="style.css"> 
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <title>Calviz</title>
</head>

<body>
    <div class="topnav" id="myTopnav">
        <a href="index.html" class="active">CALVIZ</a>
        <a href="index.html">Home</a>
        <a href="riemann.html">Riemann Integral</a>
        <a href="derivative.html">Derivative</a>
        <a href="limit.html">L'hospital</a>
        <a href="series.html">Taylor series</a>
        <a href="javascript:void(0);" class="icon">
            <i class="fa fa-bars"></i>
        </a>
    </div>

    <div class="card" data-card-id="deriv-intro-1">
        <div class="typewriter">
            <div class="title">
                Introduction to Derivative
            </div>
        </div>
        <div class="subtitle">
            Instantaneous velocity
        </div>
        <div class="description">
            If we drive an automobile from one town to another 80 miles away in 2 hours, our average velocity is 40
            miles per hour. But during our trip the speedometer reading was often different from 40.At
            the start, it registered 0; at times it rose as high as 57. What the speedometer reads at a
            particular instant is the instantaneous velocity at that instant. 
        </div>
        <div class="description">
            Average velocity is counted by dividing the distance traveled by the time taken to travel that distance.
            The smaller the time interval, the closer the average velocity over that interval is to the instantaneous velocity.
            If we let the time interval shrink to zero, the average velocity approaches the instantaneous velocity.
            \[
            v = \lim_{Δt \to 0} v_{avg} = \lim_{Δt \to 0} \frac{f(x+Δt) - f(x)}{Δt}
            \]
        </div>
    </div>

    <div class="card" data-card-id="deriv-def">
        <div class="subtitle">
            Definition of a Derivative
        </div>
        <div class="description">
            Using the example of velocity above, derivative of a function at a point is the limit of the average rate of change of the function over an interval as the interval shrinks to zero.
            \[
            f'(a) = \lim_{h \to 0} \frac{f(a+h) - f(a)}{h}
            \]
        </div>
    </div>

    <div class="card" data-card-id="deriv-vis">
        <div class="subtitle">
            Derivative Visualisation
        </div>
        <div class="description">
            evaluated at: <span id="xLabel">0</span>
        </div>
        <div class="description">
            <input id="x" type="range" min="0" max="6" value="0"  step="0.1"/>
        </div>
        <div class="description">
            Δtime : <span id="timeLabel">1</span>
        </div>
        <div class="description">
            <input id="time" type="range" min="0.01" max="2" value="1"  step="0.01"/>
        </div>
        <canvas id="deriv" width="1000" height="400"></canvas>
        <div class="description">
        f(x) = <b id="yLabel">-</b>, f(x+Δtime) = <b id="yhLabel">-</b>,
        </div>
        Legend :
          <span style="color:red;">Red</span> is the tangent line, <span style="color:blue;">Blue</span> is the Position.
    </div>

    <div class="card" style="text-align: center; max-width: 80%; margin: 2rem auto; padding: 1rem 2rem;">
        <div class="subtitle" style="padding-bottom: 0;">Module Status: Derivative</div>
        <button id="module-complete-toggle" 
                class="selection" 
                style="background-color: #6200ff; color: white; border: none; font-size: 1.2rem;">
            Mark Module as Complete
        </button>
    </div>

    <div class="social">
        <div class="content">
            <div class="subtitle">My Socials : </div>
        <div class="socials">
            <a href ="https://discord.com/users/864557474853290034">
                <div class="social-icons">
                    <img src="assets/discord.png" alt="Profile picture"><span class="links">DISCORD</span>
                </div>
            </a>
            <a href ="https://www.instagram.com/kletka69420/?next=%2F">      
                <div class="social-icons">
                    <img src="assets/ig.png" alt="ig"><span class="links">INSTAGRAM</span>
                </div>
            </a>
            <a href ="https://www.linkedin.com/feed/?trk=guest_homepage-basic_google-one-tap-submit">
                <div class="social-icons">
                    <img src="assets/linkedin.png" alt="Profile picture"><span class="links">LINKEDIN</span>
                </div>
            </a>
            <a href="https://www.youtube.com/@transracialtrain9151">
                <div class="social-icons">
                    <img src="assets/youtube.png" alt="Profile picture"><span class="links">YOUTUBE</span>
                </div>
            </a>
            <a href="https://github.com/venator69">
                <div class="social-icons">
                    <img src="assets/github.png" alt="Profile picture"><span class="links">GITHUB</span>
                </div>
            </a>
        </div>
    </div>

<script>
    const canvas = document.getElementById("deriv");
    const ctx = canvas.getContext("2d");
    const timeLabel = document.getElementById('timeLabel');
    const xLabel = document.getElementById('xLabel');
    const yLabel = document.getElementById('yLabel');
    const yhLabel = document.getElementById('yhLabel');
    const a = 0, b = 6;

    const xInput = document.getElementById('x');
    const timeInput = document.getElementById('time');
    const moduleToggleButton = document.getElementById('module-complete-toggle');


    /*************************************
            Helper Functions
    **************************************/
    function mapX(x, a, b) {
        return (x - a) / (b - a) * canvas.width;
    }

    function mapY(y, minY, maxY) {
        return canvas.height - (y - minY) / (maxY - minY) * canvas.height;
    }

    function drawAxes(a, b, minY, maxY) {
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 2;

        // y-axis
        const x0 = (0 - a) / (b - a) * canvas.width;
        ctx.beginPath();
        ctx.moveTo(x0, 0);
        ctx.lineTo(x0, canvas.height); 
        ctx.stroke();

        // x-axis
        // Find position of y=0 on the canvas
        const y0 = mapY(0, minY, maxY);
        ctx.beginPath();
        ctx.moveTo(0, y0);
        ctx.lineTo(canvas.width, y0);
        ctx.stroke();
    }


    /*************************************
            Drawing Functions
    **************************************/
    function drawTangent(x, time) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Compute Y bounds
        let minY = Infinity, maxY = -Infinity;
        const fn = (x) => 5 + 5 * Math.sin(x); 
        
        for (let i = 0; i <= 100; i++) {
            const xi = 0 + (6) * i / 100;
            const y = fn(xi);
            if (y < minY) minY = y;
            if (y > maxY) maxY = y;
        }
        const margin = 0.1 * (maxY - minY);
        minY -= margin;
        maxY += margin;

        
        drawAxes(0, 6, minY, maxY);

        // Draw function (Blue - Position)
        ctx.beginPath();
        ctx.strokeStyle = 'blue';
        ctx.lineWidth = 3;
        for (let px = 0; px <= 6; px += 0.01) {
            const y = fn(px);
            ctx.lineTo(mapX(px, 0, 6), mapY(y, minY, maxY));
        }
        ctx.stroke();

        // Draw tangent (Red - Secant line approaching tangent)
        ctx.beginPath();
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 2;
        
        const y_x = fn(x);
        const y_x_plus_dt = fn(x + time);
        
        // Slope of the secant line
        const slope = (y_x_plus_dt - y_x) / time;
      
        const lineStart = x - 1;
        const lineEnd = x + 1 + time; 

        for (let px = lineStart; px <= lineEnd; px += 0.01) {
            // y = f(x) + m * (px - x)
            const ynew = y_x + slope * (px - x);
            
            const px_mapped = mapX(px, 0, 6);
            const py_mapped = mapY(ynew, minY, maxY);
            
            if (px_mapped >= 0 && px_mapped <= canvas.width && py_mapped >= -100 && py_mapped <= canvas.height + 100) {
                 ctx.lineTo(px_mapped, py_mapped);
            } else {
                 ctx.moveTo(px_mapped, py_mapped);
            }
        }
        ctx.stroke();
        
        // Draw point f(x)
        ctx.fillStyle = 'black';
        ctx.beginPath();
        ctx.arc(mapX(x, a, b), mapY(y_x, minY, maxY), 5, 0, 2 * Math.PI);
        ctx.fill();
        
        // Draw point f(x + dt)
        ctx.fillStyle = 'red';
        ctx.beginPath();
        ctx.arc(mapX(x + time, a, b), mapY(y_x_plus_dt, minY, maxY), 5, 0, 2 * Math.PI);
        ctx.fill();
    }

    /*************************************
            Update Function
    **************************************/
    function update() {
        const timeUp = parseFloat(timeInput.value);
        const xUp = parseFloat(xInput.value);
        const fn = (x) => 5 + 5 * Math.sin(x);

        timeLabel.textContent = timeUp.toFixed(2);
        xLabel.textContent = xUp.toFixed(2);

        const yUp = fn(xUp);
        const yhUp = fn(xUp + timeUp);
        yLabel.textContent = yUp.toFixed(6);
        yhLabel.textContent = yhUp.toFixed(6);

        drawTangent(xUp, timeUp);
    }

    /*************************************
            Event Listeners
    **************************************/
    [xInput, timeInput].forEach(el =>
        el.addEventListener('input', update)
    );

    update();

    // Toggle Burger Menu
    function toggleBurger() {
        const topnav = document.getElementById("myTopnav");
        topnav.classList.toggle("responsive");
    }

    // Add click listener to burger icon
    document.querySelector(".topnav .icon").addEventListener("click", toggleBurger);

    /*************************************
     LOCAL STORAGE MODULE PROGRESS TRACKER
    **************************************/

    const MODULE_ID = 'derivative';
    const STORAGE_KEY_MODULE = `calviz_module_${MODULE_ID}_complete`;
    
    function loadModuleStatus() {
        const isComplete = localStorage.getItem(STORAGE_KEY_MODULE) === 'true';
        updateModuleButton(isComplete);
    }

    function updateModuleButton(isComplete) {
        if (isComplete) {
            moduleToggleButton.textContent = 'Module Complete ✓';
            moduleToggleButton.style.backgroundColor = '#00a6cf';
            document.querySelectorAll('.card').forEach(card => card.classList.add('read'));
        } else {
            moduleToggleButton.textContent = 'Mark Module as Complete';
            moduleToggleButton.style.backgroundColor = '#6200ff';
            document.querySelectorAll('.card').forEach(card => card.classList.remove('read'));
        }
    }

    window.toggleModuleStatus = function() {
        const isCurrentlyComplete = localStorage.getItem(STORAGE_KEY_MODULE) === 'true';
        const newStatus = !isCurrentlyComplete;

        localStorage.setItem(STORAGE_KEY_MODULE, newStatus ? 'true' : 'false');
        updateModuleButton(newStatus);
    }
        
    moduleToggleButton.addEventListener('click', window.toggleModuleStatus);
    document.addEventListener('DOMContentLoaded', loadModuleStatus); 
</script>

</body>
</html>