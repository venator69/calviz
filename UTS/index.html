<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Calviz</title>
    <style>
        body {
          margin: 0;
          font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
          background: linear-gradient(45deg, #6200ff, #00c3ff);
        }
        
        .topnav {
          overflow: hidden;
          background-color: #333;
          display: flex;
        }
        
        .topnav a {
          float: left;
          display: block;
          color: #f2f2f2;
          text-align: center;
          padding: 14px 16px;
          text-decoration: none;
          font-size: 1rem;
        }
        
        .topnav a:hover {
          background-color: #ddd;
          color: black;
          animation-duration: 0.1s;
        }
        
        .topnav a.active {
          background: white;
          font-family: Courier, monospace;
          font-weight: 1000;
          color: #333;
          text-align: center;
          width: 30%;
        }
        
        .topnav .icon {
          display: none;
        }
        .title {
          font-size: clamp(2rem, 4vw, 4rem);   /* min 2rem, scales, max 5rem */
          max-width: 70%;
        }

        .subtitle {
          color: #333;
          font-size: clamp(1rem, 2vw, 2rem);   /* min 1rem, scales, max 2rem */
          max-width: 60%;
          padding: 1rem 0;
        }
        .typewriter{
          color: #6200ff;
          font-family: monospace;
          overflow: hidden; /* Ensures the content is not revealed until the animation */
          border-right: .15em solid orange; /* The typwriter cursor */
          white-space: nowrap; /* Keeps the content on a single line */
          margin: 0 auto; /* Gives that scrolling effect as the typing happens */
          letter-spacing: .15em; /* Adjust as needed */
          animation: 
            typing 3.5s steps(30, end),
            blink-caret .5s step-end infinite;
        }

        @keyframes typing {
          from { width: 0 }
          to { width: 100% }
        }

        @keyframes blink-caret {
          from, to { border-color: transparent }
          30% { border-color: orange }
        }

        .image-container img {
          max-width: 400px; 
          height: auto;
        }
        .pp img {
          width: 36px; 
          height: 36px;
          border-radius: 50%;
        }
        #pp {
          display: flex;           
          margin-left: auto; 
          align-items: center;   
          padding: 0 10px;     
        }

        .topnav a.pp {
          padding: 0;
        }
        .topnav a.pp:hover {
          background: none;   /* Remove background change on hover */
          color: #f2f2f2;     /* Keep text color the same */
          transform: none;    /* Remove scaling or movement */
          box-shadow: none;   /* Remove shadow if applied */
          cursor: default;    /* Optional: remove pointer cursor */
        }


        .wrapper {
          overflow: hidden;
          margin: 2rem;
          display: flex;
          align-items: center;      /* vertically align text & image */
          justify-content: space-between; /* push content left, image right */
          padding: 2rem;
          background: white;
          border-radius: 2rem;
          box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2); 
        }
        .social {
          display: flex;
          align-items: center;      /* vertically align text & image */
          justify-content: space-between; /* push content left, image right */
          padding: 2rem;
          margin: 2rem;
          background: white;
          border-radius: 2rem;
          box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2); 
        }

        .butts  {
          background:linear-gradient(200deg,rgb(0, 209, 105),#00cfa2);
          color:white;
          font-size: clamp(1.5rem, 5vw, 2rem);
          padding:  1.5rem;
          margin: 1rem;
          border: 2px solid white;   
          border-radius: 2rem;
        }
        .butts:hover {
          background: linear-gradient(200deg,rgb(0, 209, 139),#00cfa2);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          border: 2px solid #00cfa2;
        }
        .buttons{
          display: flex;
          justify-content: center;
          flex-wrap: wrap;
        }
        .social{
          max-width: 100%;
          font-family: 'Courier New', Courier, monospace;
          color: black;
        }

        .social-icons img {
          max-width: 60px;
          height: auto;
          cursor: pointer; 
          transition: transform 0.2s;
          padding: 1rem 4rem;
        }
        .social-icons img:hover {
          transform: scale(1.2);
        }
        .social-icons {
          display: inline-block;   
          gap: 0.75rem;               
          font-size: 1rem;
          padding: 0.5rem 1rem;
        }
        .links {
          display: none;
        }
        a {
          text-decoration: none;
          color: inherit;
        }
        .pronoun{
          display: none;
        }
        #hoverimage img {
          width: 300px;
          height: 300px;
          transition: opacity 0.5s ease-in-out; /* smooth fade */
          opacity: 1;
          padding: 2rem;
        }

        #hoverimage img.fade-out {
          opacity: 0;
        }
        #songtitlesmall {
          display: none;
        }
        .songtitle {
            position: relative;
            display: flex;
            align-items: center;
            gap: 1rem;          /* add space between icon and text */
            animation: moveAndColor 2s forwards; /* play once and stop at the end */
        }

        /* Keyframes for movement and color change */
        
        @keyframes moveAndColor {
            0% {
                left: 100%;
                color: rgb(89, 0, 255);
            }
            20% {
                color: rgb(0, 162, 255);
            }
            40% {
                color: rgb(0, 255, 221);
            }
            60% {
                color: rgb(0, 255, 0);
            }
            80% {
                color: rgb(0, 255, 221);
            }
            100% {
                left: 5%;
                color: rgb(0, 162, 255);
            }
        }
        #muteBtn {
          background: none;
          border: none;
          cursor: pointer;
          font-size: 2rem;
          color: #333;
          align-content: center;
        }
        #muteSm {
          background: none;
          border: none;
          cursor: pointer;
          font-size: 2rem;
          color: #333;
          align-content: center;
        }

        .login {
          padding-right: 10px;
          margin-left: auto; 
        }

        .topnav.responsive a {
          display: block;
        }

        .profile-dropdown {
          position: relative;
          display: flex;
          align-items: center;
          cursor: pointer;
        }

        .profile-dropdown img {
          width: 36px;
          height: 36px;
          border-radius: 50%;
        }

        .dropdown-content {
          display: none;
          position: absolute;
          top: 50px;
          right: 0;
          background-color: #f9f9f9;
          min-width: 100px;
          box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
          border-radius: 5px;
          z-index: 10;
        }

        .dropdown-content a {
          color: black;
          padding: 8px 12px;
          text-decoration: none;
          display: block;
        }

        .dropdown-content a:hover {
          background-color: #ddd;
        }

        .profile-dropdown:hover .dropdown-content {
          display: block;
        }


        @media screen and (max-width: 1000px) {
          .topnav a:not(:first-child) {display: none;}
          
          .topnav a.icon {
            float: right;
            display: block;
          }
        }
        
        @media screen and (max-width: 1000px) {
          .topnav.responsive {position: relative;}
          .topnav.responsive .icon {
            position: absolute;
            right: 0;
            top: 0;
            
          }
          .topnav.responsive a {
            float: none;
            display: block;
            text-align: left;
          }
          .subtitle{
            font-size: 1rem;
            text-align: center;
            max-width: 100%;
          }
          .wrapper{
            display: block;
          }
          .content{
            max-width: 100%;
          }
          .image-container {
            display: flex;
            justify-content: center;
          }
          .image-container img{
            justify-content: center;
          }
          .butts{
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(1rem,5vw,1.5rem);
          }
          .title{
            display: none;
          }
          .pronoun{
            display: Block;
            font-size: clamp(1.3rem,5vw,4rem);
          }
          #hoverimage img {
            width: 60%;      
            max-width: 220px;
            height: auto;    
          }
          .social-icons img {
          max-width: 30px;
          height: auto;
          cursor: pointer; 
          transition: transform 0.2s;
          padding: 0.5rem 1rem;
          }
          .social{
            display: flex;
            padding: 1rem;
          }
          .social-icons {
          display: flex;              
          align-items: center;        
          gap: 0.75rem;               
          font-size: 1rem;
          font-weight: bold;
          color: black;
          padding: 0.5rem 1rem;
          justify-content: center;
          }
          .links{
          display: inline;
          }
          #songtitlebig{
            display: none;
          }
          #songtitlesmall {
            display: flex;
          }
        }
    </style>
</head>
<body>
<div class="topnav" id="myTopnav">
  <a href="index.html" class="active">CALVIZ</a>
  <a href="index.html">Home</a>
  <a href="riemann.html">Riemann Integral</a>
  <a href="derivative.html">Derivative</a>
  <a href="limit.html">L'hospital</a>
  <a href="series.html">Taylor series</a>
  <a href="login.html" class="login">login</a>

  <div class="profile-dropdown" id="pp">
    <img src="default.jpg" alt="Profile picture" id="profilePic">
    <div class="dropdown-content" id="logoutMenu">
      <a href="javascript:void(0);" id="logoutBtn">Logout</a>
    </div>
  </div>

  <a href="javascript:void(0);" class="icon">
    <i class="fa fa-bars"></i>
  </a>
</div>

  <div class="wrapper">
    <div class="content" id="hoverBtn">
      <audio loop id="hoverAudio">
      <source src="Autopilot.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
      </audio>
      <div class="typewriter">
        <div class="title"> Welcome to CALVIZ !!</div>
        <div class="pronoun">Welcome to</div>
        <div class="pronoun">CALVIZ !!</div>
      </div>
      <div class="subtitle">Interactive calculus visualization for visual learners</div> 
      <div class="buttons">
        <a href="riemann.html">
          <button class="butts" id="integral">Riemann Integral</button>
        </a>
        <a href="derivative.html">
          <button class="butts" id="derivative">Derivative</button>
        </a>
      </div>
            <div class="buttons">
        <a href="limit.html">
          <button class="butts" id="limit">L'Hospital</button>
        </a>
        <a href="series.html">
          <button class="butts" id="series">Taylor series</button>
        </a>
      </div>
    </div>
    <div class="image-container">
      <div id="hoverimage">
        <img src="profile.png" alt="Profile picture">
      </div>
      <div class="songtitle" id="songtitlebig">
        <button id="muteBtn">
          <i id="muteIcon" class="fa fa-volume-off"></i> 
        </button>
        <i> Song : Autopilot - Kitsch</i>
      </div>
    </div>
      <div class="songtitle" id="songtitlesmall">
        <button id="muteSm">
          <i id="muteIconSm" class="fa fa-volume-off"></i> 
        </button>
        <i> Song : Autopilot - Kitsch</i>
      </div>

  </div>
  <div class="social">
    <div class="content">
      <div class="typewriter">
        <div class="subtitle">My Socials : </div>
      </div>
    <div class="socials">
      <a href ="https://discord.com/users/864557474853290034">
        <div class="social-icons">
          <img src="discord.png" alt="Profile picture"><span class="links">DISCORD</span>
        </div>
      </a>
      <a href ="https://www.instagram.com/kletka69420/?next=%2F">      
        <div class="social-icons">
          <img src="ig.png" alt="ig"><span class="links">INSTAGRAM</span>
        </div>
      </a>
      <a href ="https://www.linkedin.com/feed/?trk=guest_homepage-basic_google-one-tap-submit">
        <div class="social-icons">
          <img src="linkedin.png" alt="Profile picture"><span class="links">LINKEDIN</span>
        </div>
      </a>
      <a href="https://www.youtube.com/@transracialtrain9151">
        <div class="social-icons">
          <img src="youtube.png" alt="Profile picture"><span class="links">YOUTUBE</span>
        </div>
      </a>
      <a href="https://github.com/venator69">
        <div class="social-icons">
          <img src="github.png" alt="Profile picture"><span class="links">GITHUB</span>
        </div>
      </a>
    </div>
  </div>
</body>
<footer>
<script>
document.addEventListener("DOMContentLoaded", async () => {

  // -----------------------------
  // LOGIN FUNCTION
  // -----------------------------
  async function loginUser(name, password) {
    if (!name || !password) return alert("Name dan password wajib diisi");

    try {
      const res = await fetch("https://calviz-server-production.up.railway.app/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, password }),
        credentials: "include" // penting untuk session cookie
      });

      const data = await res.json().catch(() => ({}));
      if (res.ok) {
        console.log("Login sukses", data);
        alert("Login berhasil!");
        await handleLoginState();
      } else {
        alert(`Login gagal: ${data.message || res.status}`);
      }
    } catch (err) {
      console.error("Login error:", err);
      alert("Login error: " + err.message);
    }
  }

  // -----------------------------
  // LOGOUT FUNCTION
  // -----------------------------
  async function logout() {
    try {
      await fetch("https://calviz-server-production.up.railway.app/logout", {
        method: "POST",
        credentials: "include"
      });
      location.reload(); // reload untuk refresh state
    } catch (err) {
      console.error("Logout error:", err);
    }
  }

  // -----------------------------
  // PROFILE CHECK FUNCTION
  // -----------------------------
  async function handleLoginState() {
    try {
      const res = await fetch("https://calviz-server-production.up.railway.app/profile", {
        method: "GET",
        credentials: "include"
      });
      const data = await res.json().catch(() => ({}));
      const loginLink = document.querySelector(".login");
      const profilePic = document.querySelector("#pp");
      const usernameLabel = document.querySelector("#username");

      if (res.ok && data.name) {
        if (loginLink) loginLink.style.display = "none";
        if (profilePic) {
          profilePic.style.display = "flex";
          profilePic.querySelector("img").src = data.profile_picture || "default.jpg";
        }
        if (usernameLabel) usernameLabel.textContent = data.name;
      } else {
        if (loginLink) loginLink.style.display = "flex";
        if (profilePic) profilePic.style.display = "none";
      }
    } catch (err) {
      console.error("Profile fetch error:", err);
    }
  }

  // -----------------------------
  // FORM SUBMIT LISTENER
  // -----------------------------
  const loginForm = document.getElementById("loginForm");
  if (loginForm) {
    loginForm.addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("nameInput").value.trim();
      const password = document.getElementById("passwordInput").value.trim();
      loginUser(name, password);
    });
  }

  // -----------------------------
  // LOGOUT BUTTON
  // -----------------------------
  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) logoutBtn.addEventListener("click", logout);

  // -----------------------------
  // INITIAL CHECK
  // -----------------------------
  await handleLoginState();

  // -----------------------------
  // EXISTING HOVER IMAGE & AUDIO LOGIC
  // -----------------------------
  const img = document.querySelector("#hoverimage img");
  const buttonImages = { integral: "profile.png", derivative: "derivative.png", limit: "limit.png", series: "series.png" };
  function changeImage(newSrc) {
    img.classList.add("fade-out");
    setTimeout(() => { img.src = newSrc; img.classList.remove("fade-out"); }, 300);
  }
  for (let id in buttonImages) {
    const btn = document.getElementById(id);
    if (btn) btn.addEventListener("mouseenter", () => changeImage(buttonImages[id]));
  }

  const topnav = document.getElementById("myTopnav");
  document.querySelector(".topnav .icon")?.addEventListener("click", () => topnav.classList.toggle("responsive"));

  const audio = document.getElementById('hoverAudio');
  const muteBtn = document.getElementById('muteBtn');
  const muteIcon = document.getElementById('muteIcon');
  if (muteBtn) muteBtn.addEventListener('click', () => { if(audio.paused) audio.play(); audio.muted = !audio.muted; muteIcon.className = audio.muted ? "fa fa-volume-off" : "fa fa-volume-up"; });

});
</script>
</footer>
</html>
